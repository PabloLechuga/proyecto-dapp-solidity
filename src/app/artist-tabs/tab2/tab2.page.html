<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      Crear Evento
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title> Nuevo Evento</ion-card-title>
      <ion-card-subtitle>Crea un evento y emite entradas como NFTs</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <form #eventForm="ngForm">
        <ion-item>
          <ion-label position="stacked">Nombre del Evento *</ion-label>
          <ion-input 
            [(ngModel)]="event.name" 
            name="name"
            type="text" 
            placeholder="Ej: Concierto Bad Bunny 2026"
            required>
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Fecha del Evento *</ion-label>
          <ion-datetime 
            [(ngModel)]="event.date" 
            name="date"
            display-format="DD/MM/YYYY HH:mm"
            picker-format="DD/MM/YYYY HH:mm"
            min="{{minDate}}"
            required>
          </ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Ubicaci贸n *</ion-label>
          <ion-input 
            [(ngModel)]="event.location" 
            name="location"
            type="text" 
            placeholder="Ej: Estadio Santiago Bernab茅u, Madrid"
            required>
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Descripci贸n</ion-label>
          <ion-textarea 
            [(ngModel)]="event.description" 
            name="description"
            rows="4"
            placeholder="Describe tu evento...">
          </ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">URL de la Imagen</ion-label>
          <ion-input 
            [(ngModel)]="event.imageUrl" 
            name="imageUrl"
            type="url" 
            placeholder="https://ejemplo.com/imagen.jpg">
          </ion-input>
        </ion-item>

        <ion-item-divider color="light">
          <ion-label>Configuraci贸n de Entradas</ion-label>
        </ion-item-divider>

        <ion-item>
          <ion-label position="stacked">N煤mero de Entradas *</ion-label>
          <ion-input 
            [(ngModel)]="event.ticketQuantity" 
            name="ticketQuantity"
            type="number" 
            min="1"
            placeholder="Ej: 100"
            required>
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Precio por Entrada (ETH) *</ion-label>
          <ion-input 
            [(ngModel)]="event.ticketPrice" 
            name="ticketPrice"
            type="number" 
            step="0.01"
            min="0"
            placeholder="Ej: 0.05"
            required>
          </ion-input>
          <ion-note slot="helper">Precio en Ether (ETH)</ion-note>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Comisi贸n por Reventa (%) *</ion-label>
          <ion-range 
            [(ngModel)]="event.royaltyPercentage" 
            name="royaltyPercentage"
            min="0" 
            max="10" 
            step="0.5"
            pin="true"
            [pinFormatter]="pinFormatter">
            <ion-label slot="start">0%</ion-label>
            <ion-label slot="end">10%</ion-label>
          </ion-range>
          <ion-note slot="helper">
            Ganar谩s {{event.royaltyPercentage}}% de cada reventa en el marketplace
          </ion-note>
        </ion-item>

        <ion-item *ngIf="walletAddress">
          <ion-label position="stacked">Tu Wallet (Recibir谩 Royalties)</ion-label>
          <ion-input 
            [value]="walletAddress" 
            readonly>
          </ion-input>
        </ion-item>

        <ion-item lines="none" *ngIf="message">
          <ion-label [color]="messageColor" class="ion-text-wrap">
            {{ message }}
          </ion-label>
        </ion-item>

        <div class="button-container">
          <ion-button 
            expand="block" 
            color="primary"
            [disabled]="!eventForm.valid || isCreating || !walletAddress"
            (click)="createEvent()">
            <ion-icon name="rocket" slot="start"></ion-icon>
            {{ isCreating ? 'Creando Evento...' : 'Publicar Evento' }}
          </ion-button>

          <ion-button 
            expand="block" 
            fill="outline"
            color="medium"
            [disabled]="isCreating"
            (click)="resetForm()">
            Limpiar Formulario
          </ion-button>
        </div>
      </form>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="event.name">
    <ion-card-header>
      <ion-card-title> Resumen</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item>
          <ion-label>Total de Entradas:</ion-label>
          <ion-note slot="end">{{ event.ticketQuantity || 0 }}</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Precio por Entrada:</ion-label>
          <ion-note slot="end">{{ event.ticketPrice || 0 }} ETH</ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Ingresos Estimados:</ion-label>
          <ion-note slot="end" color="success">
            {{ (event.ticketQuantity * event.ticketPrice) || 0 }} ETH
          </ion-note>
        </ion-item>
        <ion-item>
          <ion-label>Royalty por Reventa:</ion-label>
          <ion-note slot="end">{{ event.royaltyPercentage || 0 }}%</ion-note>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>
</ion-content>
